{% set layout = "ClarolineCoreBundle:Workspace:layout.html.twig" %}

{% if isDesktop() %}
    {% set layout = "ClarolineCoreBundle:Desktop:layout.html.twig" %}
{% else %}
    {% set workspace = _resource.getResourceNode().getWorkspace() %}
{% endif %}

{% extends layout %}

{% block title %}{{ _resource.getResourceNode().getName() | striptags | raw }}{% endblock %}

{% block section_content %}
    <div class="panel-heading">
        <h3 class="panel-title">{{ _resource.getResourceNode().getName() }}</h3>
    </div>
    <div class="panel-body" id="text_content">
        <form action="{{ path('cpasimusante_item select', { }) }}" method="post" {{ form_enctype(edit_form) }}>
            <label class="control-label col-md-4" for="clinical-case">Cas clinique</label>
            <select class="form-control" id="clinical-case" name="clinical-case">
                <option value="">Choissisez un cas</option>
            </select>

            <label class="control-label col-md-4" for="dfasm">A quels items DFASM correspond-il ?</label>
            <div id="tableChoice"></div>

            <a href="#" class="btn btn-info form-collection-add">Add</a>
            <button class="btn btn-default" type="button" data-toggle="tooltip" title="Cliquez pour ajouter">
                <span class="fa fa-plus"></span>Ajouter un item
            </button>
        </form>
    </div>

    <div class="panel-footer">Footer</div>
{% endblock %}

{% block javascripts %}
    {# Claroline JS #}
    {{ parent() }}
    <script type="text/javascript">
        $(document).ready(function() {
            var container = $('div#cpasimusante_item_choices'); // Div which contain the dataprototype
            var tableItems = $('#tableItems'); // div which contain the choices array

            function addItem(container, deleteChoice, edition) {

                var index = $('#newTable').find('tr:not(:first)').length;
                index++;

                // change the "name" by the index and delete the symfony delete form button
                var contain = $(container.attr('data-prototype').replace(/__name__label__/g, 'Choice nÂ°' + (index))
                                .replace(/__name__/g, index)
                                .replace('<a class="btn btn-danger remove" href="#">Delete</a>', '')
                );
                // Add the button to delete a choice
                addDelete(contain, deleteChoice);
                // Add the modified dataprototype to the page
                container.append(contain);

                // Get the form field to fill rows of the choices' table
                container.find('.row').each(function () {
                    fillChoicesArray($(this),edition,index);
                });

                // Add the delete button
                $('#newTable').find('tr:last').append('<td class="classic"></td>');
                $('#newTable').find('td:last').append(contain.find('a.btn-danger'));
                // Remove the useless fileds form
                container.remove();
                tableItems.next().remove();

                $('#cpasimusante_item_choices_'+index+'_item').click(function() {
                    $(this).focus();
                });
            }
        });
    </script>
{% endblock %}
