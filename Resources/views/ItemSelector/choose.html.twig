{% set layout = "ClarolineCoreBundle:Workspace:layout.html.twig" %}

{% if isDesktop() %}
    {% set layout = "ClarolineCoreBundle:Desktop:layout.html.twig" %}
{% else %}
    {% set workspace = _resource.getResourceNode().getWorkspace() %}
{% endif %}

{% extends layout %}

{% block title %}{{ _resource.getResourceNode().getName() | striptags | raw }}{% endblock %}

{% block section_content %}
    <form action="{{ path('cpasimusante_choose_item', {'id': 1}) }}" method="post" {{ form_enctype(form) }}>

    <div class="panel-heading">
        <h3 class="panel-title">{{ _resource.getResourceNode().getName() }}</h3>
    </div>
    <div class="panel-body" id="text_content">
        {{ form_widget(form) }}
          {#  {{ form_row(form.resource) }} #}
<!--
            <label class="control-label col-md-4" for="clinical-case">Cas clinique</label>
            <select class="form-control" id="clinical-case" name="clinical-case">
                <option value="">Choissisez un cas</option>
            </select>
-->
        <label class="control-label col-md-4" for="dfasm">A quels items DFASM correspond-il ?</label>
        <div id="tableChoice"></div>

        <a href="#" class="btn btn-info form-collection-add">Add</a>
        <button class="btn btn-default" type="button" data-toggle="tooltip" title="Cliquez pour ajouter">
            <span class="fa fa-plus"></span>Ajouter un item
        </button>
    </div>

    <div class="panel-footer">
        <button type="button" class="btn btn-default" >{{ 'cancel'|trans({}, 'platform') }}</button>
        <button type="submit" class="btn btn-primary">{{ 'save'|trans({}, 'platform') }}</button>
    </div>
    </form>

<!-- Display Exercices -->

    {# {% for resource in _resource.getParameters().getSecondaryResources() %}
    <div class="hide" id="resource-{{ resource.getId() }}">
        <iframe class="activity-iframe" src="{{ path('claro_resource_open', { 'resourceType': resource.getResourceType().getName(), 'node': resource.getId() }) }}"></iframe>
    </div>
     {% endfor %}    #}

{% endblock %}

{% block javascripts %}
    {# Claroline JS #}
    {{ parent() }}
    <script type="text/javascript">
        $(document).ready(function() {
/*
            var manager = window.Claroline.ResourceManager;

            //Add a ressource Picker event for the Clinical case (wiki)
            $('body').on('click', '.add-resource', function () {
                var resource = $(this).data('id');

                if (!manager.hasPicker('itemselectorResourcePicker')) {
                    manager.createPicker('itemselectorResourcePicker', {
                        callback: function (nodes) {
                            var nodeId = _.keys(nodes)[0];
                            addResource(resource, nodeId);
                        },
                        typeWhiteList: ['wiki'],
                        restrictForOwner: true,
                        isPickerMultiSelectAllowed: false,
                        isDirectorySelectionAllowed: false
                    }, true);
                } else {
                    manager.picker('itemselectorResourcePicker', 'open');
                }
            });


            var container = $('div#cpasimusante_item_choices'); // Div which contain the dataprototype
            var tableItems = $('#tableItems'); // div which contain the choices array

            function addItem(container, deleteChoice, edition) {

                var index = $('#newTable').find('tr:not(:first)').length;
                index++;

                // change the "name" by the index and delete the symfony delete form button
                var contain = $(container.attr('data-prototype').replace(/__name__label__/g, 'Choice nÂ°' + (index))
                                .replace(/__name__/g, index)
                                .replace('<a class="btn btn-danger remove" href="#">Delete</a>', '')
                );
                // Add the button to delete a choice
                addDelete(contain, deleteChoice);
                // Add the modified dataprototype to the page
                container.append(contain);

                // Get the form field to fill rows of the choices' table
                container.find('.row').each(function () {
                    fillChoicesArray($(this),edition,index);
                });

                // Add the delete button
                $('#newTable').find('tr:last').append('<td class="classic"></td>');
                $('#newTable').find('td:last').append(contain.find('a.btn-danger'));
                // Remove the useless fileds form
                container.remove();
                tableItems.next().remove();

                $('#cpasimusante_item_choices_'+index+'_item').click(function() {
                    $(this).focus();
                });
            }
*/
        });
    </script>
{% endblock %}
